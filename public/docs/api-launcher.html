<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lanzador API Docs</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 600px; 
            margin: 50px auto; 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            text-align: center; 
        }
        .btn { 
            background: #17a2b8; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px; 
            text-decoration: none; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
        }
        .btn:hover { background: #138496; }
        .loading { display: none; color: #6c757d; }
        .instructions { 
            background: #e9ecef; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 20px 0; 
            text-align: left; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Documentaci칩n API</h1>
        <p>Este lanzador abrir치 Swagger Editor con la documentaci칩n de tu API Firebase.</p>
        
        <div class="instructions">
            <h3>Instrucciones:</h3>
            <ol>
                <li>Haz clic en "Abrir Swagger Editor"</li>
                <li>Se abrir치 <strong>https://editor.swagger.io/</strong></li>
                <li><strong>PASO IMPORTANTE:</strong> Pega el contenido YAML manualmente</li>
                <li>춰Listo! Tendr치s tu documentaci칩n interactiva</li>
            </ol>
        </div>
        
        <button id="launchBtn" class="btn" onclick="launchSwaggerEditor()">
            <i>游늶</i>
            Abrir Swagger Editor
        </button>

        <button id="copyBtn" class="btn" onclick="copyYAMLContent()" style="background: #28a745; margin-left: 10px;">
            <i>游늯</i>
            Copiar YAML
        </button>
        
        <div id="loading" class="loading">
            <p>Abriendo Swagger Editor...</p>
        </div>

        <div id="status" style="margin-top: 20px; font-weight: bold;"></div>

        <div style="margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px;">
            <h4>쯇roblemas?</h4>
            <p>Si el m칠todo autom치tico no funciona:</p>
            <ol style="text-align: left;">
                <li>Haz clic en "Copiar YAML"</li>
                <li>Ve manualmente a <a href="https://editor.swagger.io/" target="_blank">https://editor.swagger.io/</a></li>
                <li>Borra todo el contenido existente</li>
                <li>Pega el YAML copiado (Ctrl+V)</li>
            </ol>
        </div>
    </div>

    <script>
        // Contenido YAML actualizado desde openapi.yaml
        const openapiContent = `openapi: 3.0.0
info:
  title: API Panel de Administraci칩n - Pasteler칤a Mil Sabores
  description: |
    Documentaci칩n de servicios Firebase Firestore - Pasteler칤a Mil Sabores
    
    **NOTA IMPORTANTE:** Esta documentaci칩n describe la arquitectura actual de la aplicaci칩n.
    Los datos se obtienen directamente desde Firebase Firestore mediante servicios JavaScript del lado del cliente.
    Los endpoints definidos aqu칤 representan la estructura de datos y operaciones disponibles.
    
    Para realizar pruebas funcionales, utiliza la aplicaci칩n web en: https://tiendapasteleriamilsabor-a193d.web.app
  version: 1.0.0
  contact:
    name: Soporte T칠cnico
    email: soporte@tiendaonline.com

servers:
  - url: https://tiendapasteleriamilsabor-a193d.web.app
    description: Aplicaci칩n web Pasteler칤a Mil Sabores (Frontend con Firebase)

tags:
  - name: Dashboard
    description: Estad칤sticas del panel de administraci칩n
  - name: Productos
    description: Gesti칩n de productos de pasteler칤a
  - name: Compras
    description: Gesti칩n de 칩rdenes de compra
  - name: Usuarios
    description: Gesti칩n de clientes y administradores
  - name: Categor칤as
    description: Categor칤as de productos de pasteler칤a

paths:
  /dashboard/estadisticas:
    get:
      tags:
        - Dashboard
      summary: Obtener estad칤sticas del dashboard
      description: |
        Recupera las estad칤sticas principales del negocio de pasteler칤a desde Firestore.
        Servicio: DashboardService.getEstadisticasCompletas()
        Colecciones Firestore utilizadas: compras, producto, usuario
      responses:
        '200':
          description: Estad칤sticas obtenidas correctamente desde Firestore
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EstadisticasDashboard'
              example:
                totalCompras: 42
                proyeccionCompras: 28
                totalProductos: 87
                inventarioTotal: 2156
                totalUsuarios: 145
                nuevosUsuariosMes: 18

  /productos:
    get:
      tags:
        - Productos
      summary: Obtener lista de productos de pasteler칤a
      description: |
        Recupera todos los productos disponibles en la tienda.
        Servicio: CrudService.getProductos()
        Colecci칩n Firestore: producto
      responses:
        '200':
          description: Lista de productos obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Producto'
              example:
                - id: "alfajores_001"
                  nombre: "Alfajores Tradicionales"
                  precio: 15000
                  stock: 45
                  categoria: "Alfajores"
                  imagen: "alfajores-tradicionales.jpg"
                  activo: true
                  descripcion: "Deliciosos alfajores rellenos de dulce de leche"
                - id: "torta_chocolate_001"
                  nombre: "Torta de Chocolate"
                  precio: 35000
                  stock: 12
                  categoria: "Tortas"
                  imagen: "torta-chocolate.jpg"
                  activo: true
                  descripcion: "Torta de chocolate derretido con cobertura de ganache"
                - id: "cupcakes_vanilla_001"
                  nombre: "Cupcakes de Vainilla"
                  precio: 8000
                  stock: 60
                  categoria: "Cupcakes"
                  imagen: "cupcakes-vanilla.jpg"
                  activo: true

    post:
      tags:
        - Productos
      summary: Crear un nuevo producto
      description: |
        Crea un nuevo producto en el cat치logo.
        Servicio: CrudService.createProducto()
        Colecci칩n Firestore: producto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'
            example:
              nombre: "Macarons de Frambuesa"
              precio: 12000
              stock: 30
              categoria: "Macarons"
              imagen: "macarons-frambuesa.jpg"
              descripcion: "Macarons franceses sabor frambuesa"
      responses:
        '201':
          description: Producto creado correctamente en Firestore
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
              example:
                id: "macarons_frambuesa_001"

  /productos/{id}:
    get:
      tags:
        - Productos
      summary: Obtener producto por ID
      description: |
        Obtiene los detalles de un producto espec칤fico.
        Servicio: CrudService.getProductoById()
        Colecci칩n Firestore: producto
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "alfajores_001"
      responses:
        '200':
          description: Producto encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
              example:
                id: "alfajores_001"
                nombre: "Alfajores Tradicionales"
                precio: 15000
                stock: 45
                categoria: "Alfajores"
                imagen: "alfajores-tradicionales.jpg"
                activo: true
                descripcion: "Deliciosos alfajores rellenos de dulce de leche"
        '404':
          description: Producto no encontrado
          content:
            application/json:
              example:
                error: "Producto no encontrado"
                message: "El producto con ID alfajores_001 no existe en Firestore"

    put:
      tags:
        - Productos
      summary: Actualizar producto existente
      description: |
        Actualiza los datos de un producto.
        Servicio: CrudService.updateProducto()
        Colecci칩n Firestore: producto
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "alfajores_001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'
            example:
              nombre: "Alfajores Premium"
              precio: 18000
              stock: 40
              categoria: "Alfajores"
      responses:
        '200':
          description: Producto actualizado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Producto actualizado correctamente en Firestore"
        '404':
          description: Producto no encontrado

    delete:
      tags:
        - Productos
      summary: Eliminar producto del sistema
      description: |
        Elimina un producto del cat치logo.
        Servicio: CrudService.deleteProducto()
        Colecci칩n Firestore: producto
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "alfajores_001"
      responses:
        '200':
          description: Producto eliminado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Producto eliminado correctamente de Firestore"
        '404':
          description: Producto no encontrado

  /compras:
    get:
      tags:
        - Compras
      summary: Obtener lista de 칩rdenes de compra
      description: |
        Recupera todas las 칩rdenes/compras registradas.
        Servicio: CrudService.getOrdenes()
        Colecci칩n Firestore: compras
      responses:
        '200':
          description: Lista de compras obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Compra'
              example:
                - id: "compra_001"
                  clienteNombre: "Mar칤a Garc칤a"
                  clienteEmail: "maria@email.com"
                  total: 45000
                  estado: "completado"
                  fecha: "2025-11-20T14:30:00Z"
                  productos:
                    - id: "alfajores_001"
                      nombre: "Alfajores Tradicionales"
                      cantidad: 2
                      precio: 15000
                    - id: "torta_chocolate_001"
                      nombre: "Torta de Chocolate"
                      cantidad: 1
                      precio: 35000
                - id: "compra_002"
                  clienteNombre: "Juan Rodr칤guez"
                  clienteEmail: "juan@email.com"
                  total: 32000
                  estado: "procesando"
                  fecha: "2025-11-22T10:15:00Z"
                  productos:
                    - id: "cupcakes_vanilla_001"
                      nombre: "Cupcakes de Vainilla"
                      cantidad: 4
                      precio: 8000

  /compras/{id}:
    get:
      tags:
        - Compras
      summary: Obtener orden de compra por ID
      description: |
        Obtiene los detalles de una orden espec칤fica.
        Servicio: CrudService.getOrdenById()
        Colecci칩n Firestore: compras
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "compra_001"
      responses:
        '200':
          description: Orden encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Compra'
              example:
                id: "compra_001"
                clienteNombre: "Mar칤a Garc칤a"
                clienteEmail: "maria@email.com"
                total: 45000
                estado: "completado"
                fecha: "2025-11-20T14:30:00Z"
                productos:
                  - id: "alfajores_001"
                    nombre: "Alfajores Tradicionales"
                    cantidad: 2
                    precio: 15000
        '404':
          description: Compra no encontrada

  /compras/{id}/estado:
    put:
      tags:
        - Compras
      summary: Actualizar estado de compra
      description: |
        Actualiza el estado de una orden (pendiente, procesando, completado, cancelado).
        Servicio: CrudService.updateOrdenEstado()
        Colecci칩n Firestore: compras
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "compra_001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                estado:
                  type: string
                  enum: [pendiente, procesando, completado, cancelado]
            example:
              estado: "completado"
      responses:
        '200':
          description: Estado actualizado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Estado actualizado a completado"
        '404':
          description: Compra no encontrada

  /usuarios:
    get:
      tags:
        - Usuarios
      summary: Obtener lista de usuarios
      description: |
        Recupera todos los usuarios (clientes y administradores).
        Servicio: CrudService.getUsuarios()
        Colecci칩n Firestore: usuario
      responses:
        '200':
          description: Lista de usuarios obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Usuario'
              example:
                - id: "user_admin_001"
                  nombre: "Carlos Mendez"
                  email: "carlos@pasteleriamilsabores.com"
                  rol: "admin"
                  activo: true
                  telefono: "+56912345678"
                  direccion: "Av. Principal 123, Santiago"
                - id: "user_cliente_001"
                  nombre: "Ana L칩pez"
                  email: "ana.lopez@email.com"
                  rol: "cliente"
                  activo: true
                  telefono: "+56987654321"
                  direccion: "Calle Secundaria 456, 칌u침oa"
                - id: "user_cliente_002"
                  nombre: "Roberto Silva"
                  email: "roberto@email.com"
                  rol: "cliente"
                  activo: true

  /usuarios/{id}:
    get:
      tags:
        - Usuarios
      summary: Obtener usuario por ID
      description: |
        Obtiene los detalles de un usuario espec칤fico.
        Servicio: CrudService.getUsuarioById()
        Colecci칩n Firestore: usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "user_admin_001"
      responses:
        '200':
          description: Usuario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
              example:
                id: "user_admin_001"
                nombre: "Carlos Mendez"
                email: "carlos@pasteleriamilsabores.com"
                rol: "admin"
                activo: true
                telefono: "+56912345678"
                direccion: "Av. Principal 123, Santiago"
                createdAt: "2024-01-01T00:00:00Z"
        '404':
          description: Usuario no encontrado

    delete:
      tags:
        - Usuarios
      summary: Eliminar usuario del sistema
      description: |
        Elimina un usuario del sistema.
        Servicio: CrudService.deleteUsuario()
        Colecci칩n Firestore: usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "user_admin_001"
      responses:
        '200':
          description: Usuario eliminado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Usuario eliminado correctamente de Firestore"
        '404':
          description: Usuario no encontrado

  /categorias:
    get:
      tags:
        - Categor칤as
      summary: Obtener lista de categor칤as de productos
      description: |
        Recupera todas las categor칤as disponibles de productos de pasteler칤a.
        Servicio: CrudService.getCategorias()
        Colecci칩n Firestore: categorias
      responses:
        '200':
          description: Lista de categor칤as obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Categoria'
              example:
                - id: "cat_alfajores"
                  nombre: "Alfajores"
                  descripcion: "Alfajores rellenos de dulce de leche, manjar y otros sabores"
                  productosCount: 8
                  activa: true
                - id: "cat_tortas"
                  nombre: "Tortas"
                  descripcion: "Tortas y tartas de diversos sabores y rellenos"
                  productosCount: 12
                  activa: true
                - id: "cat_cupcakes"
                  nombre: "Cupcakes"
                  descripcion: "Cupcakes decorados y personalizados"
                  productosCount: 15
                  activa: true
                - id: "cat_galletas"
                  nombre: "Galletas"
                  descripcion: "Galletas caseras de diferentes tipos"
                  productosCount: 10
                  activa: true
                - id: "cat_macarons"
                  nombre: "Macarons"
                  descripcion: "Macarons franceses de sabores variados"
                  productosCount: 6
                  activa: true

components:
  schemas:
    EstadisticasDashboard:
      type: object
      description: Estad칤sticas principales del panel de administraci칩n
      properties:
        totalCompras:
          type: integer
          description: Total de 칩rdenes procesadas
          example: 42
        proyeccionCompras:
          type: integer
          description: Proyecci칩n porcentual de crecimiento en compras
          example: 28
        totalProductos:
          type: integer
          description: Cantidad total de productos en cat치logo
          example: 87
        inventarioTotal:
          type: integer
          description: Suma total de unidades en inventario
          example: 2156
        totalUsuarios:
          type: integer
          description: Cantidad total de usuarios registrados
          example: 145
        nuevosUsuariosMes:
          type: integer
          description: Nuevos usuarios registrados en el mes actual
          example: 18

    Producto:
      type: object
      description: Producto de pasteler칤a
      properties:
        id:
          type: string
          description: ID 칰nico del producto en Firestore
          example: "alfajores_001"
        nombre:
          type: string
          description: Nombre del producto
          example: "Alfajores Tradicionales"
        precio:
          type: number
          description: Precio en pesos chilenos
          example: 15000
        stock:
          type: integer
          description: Cantidad disponible
          example: 45
        categoria:
          type: string
          description: Categor칤a a la que pertenece
          example: "Alfajores"
        imagen:
          type: string
          description: Nombre del archivo de imagen
          example: "alfajores-tradicionales.jpg"
        descripcion:
          type: string
          description: Descripci칩n del producto
          example: "Deliciosos alfajores rellenos de dulce de leche"
        activo:
          type: boolean
          description: Si el producto est치 disponible
          example: true
        createdAt:
          type: string
          format: date-time
          description: Fecha de creaci칩n

    ProductoInput:
      type: object
      description: Datos para crear o actualizar un producto
      required:
        - nombre
        - precio
        - stock
      properties:
        nombre:
          type: string
          example: "Macarons de Frambuesa"
        precio:
          type: number
          example: 12000
        stock:
          type: integer
          example: 30
        categoria:
          type: string
          example: "Macarons"
        imagen:
          type: string
          example: "macarons-frambuesa.jpg"
        descripcion:
          type: string
          example: "Macarons franceses sabor frambuesa"

    Compra:
      type: object
      description: Orden de compra / transacci칩n
      properties:
        id:
          type: string
          description: ID 칰nico de la compra
          example: "compra_001"
        clienteNombre:
          type: string
          description: Nombre del cliente
          example: "Mar칤a Garc칤a"
        clienteEmail:
          type: string
          description: Email del cliente
          example: "maria@email.com"
        total:
          type: number
          description: Monto total en pesos chilenos
          example: 45000
        estado:
          type: string
          enum: [pendiente, procesando, completado, cancelado]
          description: Estado de la compra
          example: "completado"
        fecha:
          type: string
          format: date-time
          description: Fecha de la compra
          example: "2025-11-20T14:30:00Z"
        productos:
          type: array
          description: Productos incluidos en la compra
          items:
            type: object
            properties:
              id:
                type: string
              nombre:
                type: string
              cantidad:
                type: integer
              precio:
                type: number

    Usuario:
      type: object
      description: Usuario del sistema (cliente o administrador)
      properties:
        id:
          type: string
          description: ID 칰nico del usuario
          example: "user_admin_001"
        nombre:
          type: string
          description: Nombre completo
          example: "Carlos Mendez"
        email:
          type: string
          format: email
          description: Correo electr칩nico
          example: "carlos@pasteleriamilsabores.com"
        rol:
          type: string
          enum: [admin, cliente]
          description: Rol del usuario
          example: "admin"
        activo:
          type: boolean
          description: Si la cuenta est치 activa
          example: true
        telefono:
          type: string
          description: N칰mero de tel칠fono
          example: "+56912345678"
        direccion:
          type: string
          description: Direcci칩n del usuario
          example: "Av. Principal 123, Santiago"
        createdAt:
          type: string
          format: date-time
          description: Fecha de registro

    Categoria:
      type: object
      description: Categor칤a de productos
      properties:
        id:
          type: string
          description: ID 칰nico de la categor칤a
          example: "cat_alfajores"
        nombre:
          type: string
          description: Nombre de la categor칤a
          example: "Alfajores"
        descripcion:
          type: string
          description: Descripci칩n de la categor칤a
          example: "Alfajores rellenos de dulce de leche, manjar y otros sabores"
        productosCount:
          type: integer
          description: Cantidad de productos en esta categor칤a
          example: 8
        activa:
          type: boolean
          description: Si la categor칤a est치 activa
          example: true
`;

        function launchSwaggerEditor() {
            const btn = document.getElementById('launchBtn');
            const loading = document.getElementById('loading');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            loading.style.display = 'block';
            status.innerHTML = 'Abriendo Swagger Editor...';
            
            try {
                // M칠todo simple: abrir Swagger Editor y preparar para pegar manualmente
                const swaggerUrl = `https://editor.swagger.io/`;
                window.open(swaggerUrl, '_blank');
                
                status.innerHTML = 'Swagger Editor abierto. <strong>Pega el contenido YAML manualmente.</strong>';
                
                // Mostrar instrucciones adicionales
                setTimeout(() => {
                    status.innerHTML += '<br><br> <strong>Instrucci칩n:</strong> Ve a la pesta침a reci칠n abierta, borra el contenido existente y pega el YAML.';
                }, 1000);
                
            } catch (error) {
                status.innerHTML = 'Error: ' + error.message;
            } finally {
                loading.style.display = 'none';
                setTimeout(() => {
                    btn.disabled = false;
                }, 2000);
            }
        }

        function copyYAMLContent() {
            const status = document.getElementById('status');
            
            try {
                // Crear un elemento temporal para copiar
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = openapiContent;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                tempTextArea.setSelectionRange(0, 99999); // Para m칩viles
                
                // Ejecutar comando de copia
                const successful = document.execCommand('copy');
                document.body.removeChild(tempTextArea);
                
                if (successful) {
                    status.innerHTML = '<strong>YAML copiado al portapapeles!</strong><br>Ahora ve a <a href="https://editor.swagger.io/" target="_blank">Swagger Editor</a> y pega el contenido.';
                    status.style.color = 'green';
                } else {
                    status.innerHTML = 'No se pudo copiar. Intenta manualmente.';
                    status.style.color = 'red';
                }
                
            } catch (error) {
                status.innerHTML = 'Error al copiar: ' + error.message;
                status.style.color = 'red';
                
                // Fallback: mostrar el contenido para copiar manualmente
                setTimeout(() => {
                    alert('Como fall칩 la copia autom치tica, aqu칤 est치 el contenido para copiar manualmente:\n\n' + openapiContent.substring(0, 1000) + '...');
                }, 500);
            }
        }

        // Versi칩n alternativa que intenta codificar de forma m치s segura
        function encodeToBase64(str) {
            try {
                // Primero convertir a bytes UTF-8
                const bytes = new TextEncoder().encode(str);
                const binary = String.fromCharCode(...bytes);
                return btoa(binary);
            } catch (e) {
                return null;
            }
        }
    </script>
</body>
</html>