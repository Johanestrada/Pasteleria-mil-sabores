openapi: 3.0.0
info:
  title: API Panel de Administración - Pastelería Mil Sabores
  description: |
    Documentación de servicios Firebase Firestore - Pastelería Mil Sabores
    
    **NOTA IMPORTANTE:** Esta documentación describe la arquitectura actual de la aplicación.
    Los datos se obtienen directamente desde Firebase Firestore mediante servicios JavaScript del lado del cliente.
    Los endpoints definidos aquí representan la estructura de datos y operaciones disponibles.
    
    Para realizar pruebas funcionales, utiliza la aplicación web en: https://tiendapasteleriamilsabor-a193d.web.app
  version: 1.0.0
  contact:
    name: Soporte Técnico
    email: soporte@tiendaonline.com

servers:
  - url: https://tiendapasteleriamilsabor-a193d.web.app
    description: Aplicación web Pastelería Mil Sabores (Frontend con Firebase)

tags:
  - name: Dashboard
    description: Estadísticas del panel de administración
  - name: Productos
    description: Gestión de productos de pastelería
  - name: Compras
    description: Gestión de órdenes de compra
  - name: Usuarios
    description: Gestión de clientes y administradores
  - name: Categorías
    description: Categorías de productos de pastelería

paths:
  /dashboard/estadisticas:
    get:
      tags:
        - Dashboard
      summary: Obtener estadísticas del dashboard
      description: |
        Recupera las estadísticas principales del negocio de pastelería desde Firestore.
        Servicio: DashboardService.getEstadisticasCompletas()
        Colecciones Firestore utilizadas: compras, producto, usuario
      responses:
        '200':
          description: Estadísticas obtenidas correctamente desde Firestore
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EstadisticasDashboard'
              example:
                totalCompras: 42
                proyeccionCompras: 28
                totalProductos: 87
                inventarioTotal: 2156
                totalUsuarios: 145
                nuevosUsuariosMes: 18

  /productos:
    get:
      tags:
        - Productos
      summary: Obtener lista de productos de pastelería
      description: |
        Recupera todos los productos disponibles en la tienda.
        Servicio: CrudService.getProductos()
        Colección Firestore: producto
      responses:
        '200':
          description: Lista de productos obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Producto'
              example:
                - id: "alfajores_001"
                  nombre: "Alfajores Tradicionales"
                  precio: 15000
                  stock: 45
                  categoria: "Alfajores"
                  imagen: "alfajores-tradicionales.jpg"
                  activo: true
                  descripcion: "Deliciosos alfajores rellenos de dulce de leche"
                - id: "torta_chocolate_001"
                  nombre: "Torta de Chocolate"
                  precio: 35000
                  stock: 12
                  categoria: "Tortas"
                  imagen: "torta-chocolate.jpg"
                  activo: true
                  descripcion: "Torta de chocolate derretido con cobertura de ganache"
                - id: "cupcakes_vanilla_001"
                  nombre: "Cupcakes de Vainilla"
                  precio: 8000
                  stock: 60
                  categoria: "Cupcakes"
                  imagen: "cupcakes-vanilla.jpg"
                  activo: true

    post:
      tags:
        - Productos
      summary: Crear un nuevo producto
      description: |
        Crea un nuevo producto en el catálogo.
        Servicio: CrudService.createProducto()
        Colección Firestore: producto
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'
            example:
              nombre: "Macarons de Frambuesa"
              precio: 12000
              stock: 30
              categoria: "Macarons"
              imagen: "macarons-frambuesa.jpg"
              descripcion: "Macarons franceses sabor frambuesa"
      responses:
        '201':
          description: Producto creado correctamente en Firestore
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
              example:
                id: "macarons_frambuesa_001"

  /productos/{id}:
    get:
      tags:
        - Productos
      summary: Obtener producto por ID
      description: |
        Obtiene los detalles de un producto específico.
        Servicio: CrudService.getProductoById()
        Colección Firestore: producto
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "alfajores_001"
      responses:
        '200':
          description: Producto encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
              example:
                id: "alfajores_001"
                nombre: "Alfajores Tradicionales"
                precio: 15000
                stock: 45
                categoria: "Alfajores"
                imagen: "alfajores-tradicionales.jpg"
                activo: true
                descripcion: "Deliciosos alfajores rellenos de dulce de leche"
        '404':
          description: Producto no encontrado
          content:
            application/json:
              example:
                error: "Producto no encontrado"
                message: "El producto con ID alfajores_001 no existe en Firestore"

    put:
      tags:
        - Productos
      summary: Actualizar producto existente
      description: |
        Actualiza los datos de un producto.
        Servicio: CrudService.updateProducto()
        Colección Firestore: producto
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "alfajores_001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'
            example:
              nombre: "Alfajores Premium"
              precio: 18000
              stock: 40
              categoria: "Alfajores"
      responses:
        '200':
          description: Producto actualizado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Producto actualizado correctamente en Firestore"
        '404':
          description: Producto no encontrado

    delete:
      tags:
        - Productos
      summary: Eliminar producto del sistema
      description: |
        Elimina un producto del catálogo.
        Servicio: CrudService.deleteProducto()
        Colección Firestore: producto
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "alfajores_001"
      responses:
        '200':
          description: Producto eliminado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Producto eliminado correctamente de Firestore"
        '404':
          description: Producto no encontrado

  /compras:
    get:
      tags:
        - Compras
      summary: Obtener lista de órdenes de compra
      description: |
        Recupera todas las órdenes/compras registradas.
        Servicio: CrudService.getOrdenes()
        Colección Firestore: compras
      responses:
        '200':
          description: Lista de compras obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Compra'
              example:
                - id: "compra_001"
                  clienteNombre: "María García"
                  clienteEmail: "maria@email.com"
                  total: 45000
                  estado: "completado"
                  fecha: "2025-11-20T14:30:00Z"
                  productos:
                    - id: "alfajores_001"
                      nombre: "Alfajores Tradicionales"
                      cantidad: 2
                      precio: 15000
                    - id: "torta_chocolate_001"
                      nombre: "Torta de Chocolate"
                      cantidad: 1
                      precio: 35000
                - id: "compra_002"
                  clienteNombre: "Juan Rodríguez"
                  clienteEmail: "juan@email.com"
                  total: 32000
                  estado: "procesando"
                  fecha: "2025-11-22T10:15:00Z"
                  productos:
                    - id: "cupcakes_vanilla_001"
                      nombre: "Cupcakes de Vainilla"
                      cantidad: 4
                      precio: 8000

  /compras/{id}:
    get:
      tags:
        - Compras
      summary: Obtener orden de compra por ID
      description: |
        Obtiene los detalles de una orden específica.
        Servicio: CrudService.getOrdenById()
        Colección Firestore: compras
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "compra_001"
      responses:
        '200':
          description: Orden encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Compra'
              example:
                id: "compra_001"
                clienteNombre: "María García"
                clienteEmail: "maria@email.com"
                total: 45000
                estado: "completado"
                fecha: "2025-11-20T14:30:00Z"
                productos:
                  - id: "alfajores_001"
                    nombre: "Alfajores Tradicionales"
                    cantidad: 2
                    precio: 15000
        '404':
          description: Compra no encontrada

  /compras/{id}/estado:
    put:
      tags:
        - Compras
      summary: Actualizar estado de compra
      description: |
        Actualiza el estado de una orden (pendiente, procesando, completado, cancelado).
        Servicio: CrudService.updateOrdenEstado()
        Colección Firestore: compras
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "compra_001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                estado:
                  type: string
                  enum: [pendiente, procesando, completado, cancelado]
            example:
              estado: "completado"
      responses:
        '200':
          description: Estado actualizado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Estado actualizado a completado"
        '404':
          description: Compra no encontrada

  /usuarios:
    get:
      tags:
        - Usuarios
      summary: Obtener lista de usuarios
      description: |
        Recupera todos los usuarios (clientes y administradores).
        Servicio: CrudService.getUsuarios()
        Colección Firestore: usuario
      responses:
        '200':
          description: Lista de usuarios obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Usuario'
              example:
                - id: "user_admin_001"
                  nombre: "Carlos Mendez"
                  email: "carlos@pasteleriamilsabores.com"
                  rol: "admin"
                  activo: true
                  telefono: "+56912345678"
                  direccion: "Av. Principal 123, Santiago"
                - id: "user_cliente_001"
                  nombre: "Ana López"
                  email: "ana.lopez@email.com"
                  rol: "cliente"
                  activo: true
                  telefono: "+56987654321"
                  direccion: "Calle Secundaria 456, Ñuñoa"
                - id: "user_cliente_002"
                  nombre: "Roberto Silva"
                  email: "roberto@email.com"
                  rol: "cliente"
                  activo: true

    get:
      tags:
        - Usuarios
      summary: Obtener usuario por ID
      description: |
        Obtiene los detalles de un usuario específico.
        Servicio: CrudService.getUsuarioById()
        Colección Firestore: usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "user_admin_001"
      responses:
        '200':
          description: Usuario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
              example:
                id: "user_admin_001"
                nombre: "Carlos Mendez"
                email: "carlos@pasteleriamilsabores.com"
                rol: "admin"
                activo: true
                telefono: "+56912345678"
                direccion: "Av. Principal 123, Santiago"
                createdAt: "2024-01-01T00:00:00Z"
        '404':
          description: Usuario no encontrado

    delete:
      tags:
        - Usuarios
      summary: Eliminar usuario del sistema
      description: |
        Elimina un usuario del sistema.
        Servicio: CrudService.deleteUsuario()
        Colección Firestore: usuario
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "user_admin_001"
      responses:
        '200':
          description: Usuario eliminado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Usuario eliminado correctamente de Firestore"
        '404':
          description: Usuario no encontrado

  /categorias:
    get:
      tags:
        - Categorías
      summary: Obtener lista de categorías de productos
      description: |
        Recupera todas las categorías disponibles de productos de pastelería.
        Servicio: CrudService.getCategorias()
        Colección Firestore: categorias
      responses:
        '200':
          description: Lista de categorías obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Categoria'
              example:
                - id: "cat_alfajores"
                  nombre: "Alfajores"
                  descripcion: "Alfajores rellenos de dulce de leche, manjar y otros sabores"
                  productosCount: 8
                  activa: true
                - id: "cat_tortas"
                  nombre: "Tortas"
                  descripcion: "Tortas y tartas de diversos sabores y rellenos"
                  productosCount: 12
                  activa: true
                - id: "cat_cupcakes"
                  nombre: "Cupcakes"
                  descripcion: "Cupcakes decorados y personalizados"
                  productosCount: 15
                  activa: true
                - id: "cat_galletas"
                  nombre: "Galletas"
                  descripcion: "Galletas caseras de diferentes tipos"
                  productosCount: 10
                  activa: true
                - id: "cat_macarons"
                  nombre: "Macarons"
                  descripcion: "Macarons franceses de sabores variados"
                  productosCount: 6
                  activa: true

components:
  schemas:
    EstadisticasDashboard:
      type: object
      description: Estadísticas principales del panel de administración
      properties:
        totalCompras:
          type: integer
          description: Total de órdenes procesadas
          example: 42
        proyeccionCompras:
          type: integer
          description: Proyección porcentual de crecimiento en compras
          example: 28
        totalProductos:
          type: integer
          description: Cantidad total de productos en catálogo
          example: 87
        inventarioTotal:
          type: integer
          description: Suma total de unidades en inventario
          example: 2156
        totalUsuarios:
          type: integer
          description: Cantidad total de usuarios registrados
          example: 145
        nuevosUsuariosMes:
          type: integer
          description: Nuevos usuarios registrados en el mes actual
          example: 18

    Producto:
      type: object
      description: Producto de pastelería
      properties:
        id:
          type: string
          description: ID único del producto en Firestore
          example: "alfajores_001"
        nombre:
          type: string
          description: Nombre del producto
          example: "Alfajores Tradicionales"
        precio:
          type: number
          description: Precio en pesos chilenos
          example: 15000
        stock:
          type: integer
          description: Cantidad disponible
          example: 45
        categoria:
          type: string
          description: Categoría a la que pertenece
          example: "Alfajores"
        imagen:
          type: string
          description: Nombre del archivo de imagen
          example: "alfajores-tradicionales.jpg"
        descripcion:
          type: string
          description: Descripción del producto
          example: "Deliciosos alfajores rellenos de dulce de leche"
        activo:
          type: boolean
          description: Si el producto está disponible
          example: true
        createdAt:
          type: string
          format: date-time
          description: Fecha de creación

    ProductoInput:
      type: object
      description: Datos para crear o actualizar un producto
      required:
        - nombre
        - precio
        - stock
      properties:
        nombre:
          type: string
          example: "Macarons de Frambuesa"
        precio:
          type: number
          example: 12000
        stock:
          type: integer
          example: 30
        categoria:
          type: string
          example: "Macarons"
        imagen:
          type: string
          example: "macarons-frambuesa.jpg"
        descripcion:
          type: string
          example: "Macarons franceses sabor frambuesa"

    Compra:
      type: object
      description: Orden de compra / transacción
      properties:
        id:
          type: string
          description: ID único de la compra
          example: "compra_001"
        clienteNombre:
          type: string
          description: Nombre del cliente
          example: "María García"
        clienteEmail:
          type: string
          description: Email del cliente
          example: "maria@email.com"
        total:
          type: number
          description: Monto total en pesos chilenos
          example: 45000
        estado:
          type: string
          enum: [pendiente, procesando, completado, cancelado]
          description: Estado de la compra
          example: "completado"
        fecha:
          type: string
          format: date-time
          description: Fecha de la compra
          example: "2025-11-20T14:30:00Z"
        productos:
          type: array
          description: Productos incluidos en la compra
          items:
            type: object
            properties:
              id:
                type: string
              nombre:
                type: string
              cantidad:
                type: integer
              precio:
                type: number

    Usuario:
      type: object
      description: Usuario del sistema (cliente o administrador)
      properties:
        id:
          type: string
          description: ID único del usuario
          example: "user_admin_001"
        nombre:
          type: string
          description: Nombre completo
          example: "Carlos Mendez"
        email:
          type: string
          format: email
          description: Correo electrónico
          example: "carlos@pasteleriamilsabores.com"
        rol:
          type: string
          enum: [admin, cliente]
          description: Rol del usuario
          example: "admin"
        activo:
          type: boolean
          description: Si la cuenta está activa
          example: true
        telefono:
          type: string
          description: Número de teléfono
          example: "+56912345678"
        direccion:
          type: string
          description: Dirección del usuario
          example: "Av. Principal 123, Santiago"
        createdAt:
          type: string
          format: date-time
          description: Fecha de registro

    Categoria:
      type: object
      description: Categoría de productos
      properties:
        id:
          type: string
          description: ID único de la categoría
          example: "cat_alfajores"
        nombre:
          type: string
          description: Nombre de la categoría
          example: "Alfajores"
        descripcion:
          type: string
          description: Descripción de la categoría
          example: "Alfajores rellenos de dulce de leche, manjar y otros sabores"
        productosCount:
          type: integer
          description: Cantidad de productos en esta categoría
          example: 8
        activa:
          type: boolean
          description: Si la categoría está activa
          example: true
